---
title: "Protéger un tableau"
format: html
editor: visual
---

# Introduction

Cette fiche pratique montre comment protéger un tableau de données en supprimant des cellules avec `GaussSuppression`. Pour ce faire on utilisera les données du package.

::: {.callout-note title="Rappels secret primaire et secondaire"}
**Secret primaire** : cellules supprimées car sensibles d'après les règles fixées (ex. fréquence, dominance). **Secret secondaire** : cellules supprimées pour empêcher la déduction du secret primaire à partir des marges du tableau.
:::

On charge les packages nécessaires.

```{r}
library(GaussSuppression)
```

# Tableau de fréquences

Pour les tableaux de comptage on applique une règle de fréquence pour le secret primaire. Pour les statistiques d'entreprise à l'Insee, le seuil de fréquence est fixé à 3. Ainsi, toutes les cellules contenant 1 ou 2 individus doivent être supprimées.

Si on doit protéger un seul tableau de fréquence, alors il convient d'utiliser la fonction `SuppressSmallCounts()`.

## À partir des microdonnées




## À partir des données pré-tabulées

Données pré-tabulées qui donnent le nombre d'accident (`freq`) ventilé par la municipalité (`mun`) et la gravité (`inj`) de l'accident.

```{r}
mun_accidents <- SSBtoolsData("mun_accidents")
head(mun_accidents)
```

On regarde les modalités de chacune des variables de croisement et on remarque qu'il n'y a pas de totaux. C'est pour cela que l'on appelle ces données pré-tabulées, il manque les marges pour qu'on ait les données tabulées complètes.

```{r}
unique(mun_accidents$mun)
unique(mun_accidents$inj)
```

Les fonctions de suppression de `GaussSuppression` calculent les marges à partir des données pré-tabulées. On peut donc directement, protéger le tableau.

```{r}
mun_acc_protege <- SuppressSmallCounts(
  data = mun_accidents,
  maxN = 3, # seuil de fréquence, secret primaire
  dimVar = 1:2, # variables de croisement
  freqVar = 3 # fréquence
  )
```

Suite à la protection des lignes ont été ajoutées dans les données.

```{r}
nrow(mun_accidents)
nrow(mun_acc_protege)
```

En effet, il s'agit des totaux des deux variables de croisement qui ont été calculés par la fonction.

```{r}
head(mun_acc_protege)
```

De plus, on voit que deux colonnes ont été ajoutées.

```{r}
ncol(mun_accidents)
ncol(mun_acc_protege)
```

La colonne `primary` est un booléen indiquant si la cellule est en secret primaire (de fréquence) ou non. La colonne `suppressed` est elle aussi un booléen qui indique quelles cellules doivent être supprimées (secret primaire et secret secondaire). Ainsi, toutes les cellules pour lesquelles `primary = FALSE` et `suppressed = TRUE` sont les cellules en secret secondaire.


## Options par défaut de `SuppressSmallCounts()`

Par défaut `SuppressSmallCounts()` supprime en secret primaire les cellules qui valent zéro.


# Tableau de volume

## A partir des microdonnées

## A partir des données pré-tabulées
